{% extends 'base.html.twig' %}

{% block title %}Create a new {{ type|capitalize }}{% endblock %}

{% block body %}
    <h2>Create a new {{ type|capitalize }}</h2>

    {{ form_start(form) }}
    {{ form_widget(form) }}
    <button class="btn btn-primary">Save</button>
    {{ form_end(form) }}

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const brandSelector = document.querySelector(".brand-selector");
            const modelSelector = document.querySelector(".model-selector");

            if (brandSelector && modelSelector) {
                brandSelector.addEventListener("change", function () {
                    const selectedBrand = this.value;

                    modelSelector.innerHTML = '<option value="">Choose a model</option>';

                    if (!selectedBrand) return;

                    fetch('/get-models', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest',
                        },
                        body: JSON.stringify({ brand: selectedBrand }),
                    })
                        .then(response => response.json())
                        .then(models => {
                            if (models.error) {
                                console.error(models.error);
                                return;
                            }

                            // Populate model dropdown with new options
                            for (const modelName of models) {
                                let option = new Option(modelName, modelName);
                                modelSelector.appendChild(option);
                            }
                        })
                        .catch(error => console.error("Error fetching models:", error));
                });
            }
        });
    </script>
{% endblock %}


